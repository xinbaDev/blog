---
title: "对一次forta contest的观察"
date: 2022-07-23T09:59:11+11:00
summary: forta是一个开源的区块链监控工具，前一段时间有读过他的源码，并专门有过相关记录。最近forta正式上线了，代币也已经可以自由交易，并且最近举行了一个bot开发的比赛。获奖者可以拿到$500-$4000不等的代币奖励，其实之前forta已经举行过几次类似的比赛，但是我都没有注意到，真正开始关注还是从这一次开始。正好前几天比赛的结果出来了，评出了3个获奖者并公布了相关的开源代码，所以打算专门记录一下。
draft: false
---

forta是一个开源的区块链监控工具，前一段时间有读过他的源码，并专门有过相关记录。最近forta正式上线了，代币也已经可以自由交易，并且最近举行了一个[bot开发的比赛](https://docs.forta.network/en/latest/contest7-forta/)。获奖者可以拿到$500-$4000不等的代币奖励，其实之前forta已经举行过几次类似的比赛，但是我都没有注意到，真正开始关注还是从这一次开始。正好前几天比赛的结果出来了，评出了3个获奖者并公布了相关的开源代码，所以打算专门记录一下。

首先这次比赛的内容是开发一个不仅可以侦测链上attack而且甚至可以提前发现attack的bot。这是一个不小的挑战，为此forta专门分享了一篇关于saddle finance的[case study](https://forta.org/blog/attack-simulation/)。这是一篇很不错的博文，尤其是对于链上监控感兴趣的人。比赛的评价标准主要是从bot implementation, testing, documentation这三个方面出发，比如bot是否能正确alert, 代码是否易读，测试的质量（有无positive/negative测试），以及文档的质量。

说完比赛内容和评价标准，再来说说这次获奖的bots。这3个获奖的bot的代码我都看过了，接下来我也按照评价标准来分析记录如下：

从功能上说，这3个bot都满足能够提前发现attack这个要求，使用的技巧也都大同小异，通过在本地fork一个区块链，然后用fuzz的方式去撞函数，如果transaction成功，则检测常见的token是否有大额数量变化。如果是则发送alert。不同的是fuzz的函数各不相同，有的可以测试多达5个parameter的函数，有的可以进行多轮fuzz。没有对区块链（eth上）的函数运行有叫深入认识是写不出来的。除了fuzz不同之外，第一名还有tornado funding和suspicious contract creation的检测，提高警报的精度。从代码的可读性角度来说，第一名代码的可读性也高于其他两个。从测试上说，也是第一名的测试写的最多质量最高。不过从文档上来说，第一名的文档就稍微弱了一些。总的来说，第一名的bot是实至名归的。

分析获奖的bot并不是这次记录的重点，我主要还是想记录一下我对这次bot开发的一些想法。其实我之前也稍微想过如何去实现这个bot,当时我并没有朝本地fork的方式去想，而是通过agent之间传递msg的方式来一层层的筛选可能的攻击，先监听tornadofunding，然后suspicious contract creation，最后在定位attack。不同于这次第一名的做法，这种并不需要在tornadofunding的阶段就send alert, 从而提高准确性。不过根据我对目前forta的架构，目前agent之间还没有办法通信，除非自己开发api来接收和提供相关数据。不过那就和这次bot的开发要求不符了，而且开发起来也麻烦。目前的forta虽然也支持多个事件的combine alert, 但是是通过graph api来实现的（为此我还专门找来graph node的代码来看，也许以后有心得可以专门再开一篇记录）。我其实不太喜欢这种方式，我认为agent之间能够调用和通信更自然和灵活。也许我之后可以开发一个本地版的forta，专门给我个人使用。

这次比赛确实让我学到不少链上监控的技巧，尤其是fuzz这一块，这是我之前没有想到的，感觉很有意思。我的感受是fuzz虽然可以提前发现攻击，但是非常容易绕过。获奖的这三个bot, 只要攻击的人有一点准备，轻易就可以绕开并让fuzz完全失效。目前还是需要辅助其他一些的监控手段，比如tornadofunding事件的监控。而且使用目前的架构可能并不能很好的fuzz，还是需要在本地使用集群的方式来做。